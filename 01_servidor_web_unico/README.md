# ğŸ—ï¸ Arquitecturas de Referencia Terraform OCI

## ğŸŒ Arquitectura 1 - Servidor Web Ãšnico

### ğŸ“‹ DescripciÃ³n General

Esta arquitectura de referencia demuestra la implementaciÃ³n mÃ¡s bÃ¡sica de recursos en Oracle Cloud Infrastructure (OCI), creando un servidor web simple accesible desde Internet. Es el punto de partida ideal para comprender los conceptos fundamentales de la infraestructura como cÃ³digo en OCI.

### ğŸ¯ Objetivo

Crear la configuraciÃ³n mÃ¡s simple de recursos OCI que incluye:
- Un compartimento para organizar los recursos
- Una Red Virtual en la Nube (VCN) con su subred pÃºblica
- Una instancia de mÃ¡quina virtual que funciona como servidor web
- ConfiguraciÃ³n de seguridad bÃ¡sica para acceso HTTP/HTTPS y SSH

### ğŸ›ï¸ Arquitectura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Oracle Cloud Infrastructure              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  Compartimento                          â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚                VCN (10.0.0.0/16)               â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                 â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚         Subred PÃºblica                  â”‚    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚         (10.0.1.0/24)                  â”‚    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                         â”‚    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚      ğŸ–¥ï¸ Servidor Web 1         â”‚    â”‚    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚    (Oracle Linux + Apache)     â”‚    â”‚    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚         IP PÃºblica             â”‚    â”‚    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚ â”‚
â”‚  â”‚  â”‚                                                 â”‚    â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ“¡ Internet Gateway                           â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTP/HTTPS (80/443)
                              â”‚ SSH (22)
                              â–¼
                         ğŸŒ Internet
```

### âœ¨ CaracterÃ­sticas

- **ğŸ”§ Simplicidad**: ConfiguraciÃ³n mÃ­nima para comenzar con OCI
- **ğŸŒ Acceso PÃºblico**: Servidor web accesible directamente desde Internet
- **ğŸ”’ Seguridad BÃ¡sica**: Lista de seguridad configurada para HTTP, HTTPS y SSH
- **âš¡ Aprovisionamiento AutomÃ¡tico**: InstalaciÃ³n automÃ¡tica de Apache y pÃ¡gina web de ejemplo
- **ğŸ“ Multi-AD**: La subred abarca todos los dominios de disponibilidad (AD1-AD3)

### ğŸ› ï¸ Recursos Desplegados

| Recurso | Tipo | DescripciÃ³n |
|---------|------|-------------|
| **Compartimento** | `oci_identity_compartment` | Contenedor lÃ³gico para organizar recursos |
| **VCN** | `oci_core_virtual_network` | Red virtual privada (10.0.0.0/16) |
| **Subred PÃºblica** | `oci_core_subnet` | Subred con acceso a Internet (10.0.1.0/24) |
| **Internet Gateway** | `oci_core_internet_gateway` | Puerta de enlace para acceso a Internet |
| **Tabla de Rutas** | `oci_core_route_table` | Enrutamiento del trÃ¡fico hacia Internet Gateway |
| **Lista de Seguridad** | `oci_core_security_list` | Reglas de firewall (SSH:22, HTTP:80, HTTPS:443) |
| **Instancia Compute** | `oci_core_instance` | MÃ¡quina virtual con Oracle Linux |
| **Claves SSH** | `tls_private_key` | Par de claves para acceso SSH |

### ğŸ” ConfiguraciÃ³n de Seguridad

#### Reglas de Entrada (Ingress)
- **SSH**: Puerto 22 desde cualquier IP (0.0.0.0/0)
- **HTTP**: Puerto 80 desde cualquier IP (0.0.0.0/0)
- **HTTPS**: Puerto 443 desde cualquier IP (0.0.0.0/0)

#### Reglas de Salida (Egress)
- **Todo el trÃ¡fico**: Permitido hacia cualquier destino

> âš ï¸ **Nota de Seguridad**: Esta configuraciÃ³n permite acceso SSH desde cualquier IP. En entornos de producciÃ³n, se recomienda restringir el acceso SSH a IPs especÃ­ficas.

---

## ğŸš€ MÃ©todos de Despliegue

### ğŸ”§ Prerrequisitos

- **Terraform** >= 0.15.0 o **OpenTofu** >= 1.0.0
- Cuenta activa de Oracle Cloud Infrastructure
- Credenciales de API configuradas
- Cliente Git instalado

---

## ğŸ”‘ AutenticaciÃ³n con OCI

Antes de desplegar los recursos, configura la autenticaciÃ³n con OCI. Puedes elegir entre dos mÃ©todos:

### ğŸ“ **OpciÃ³n 1: Variables de Entorno**

<details>
<summary>ğŸ‘† Haz clic para expandir las instrucciones</summary>

#### 1. Copiar el archivo de ejemplo
```bash
cp setup_oci_tf_vars.sh.example setup_oci_tf_vars.sh
```

#### 2. Editar el archivo de configuraciÃ³n
Abre `setup_oci_tf_vars.sh` y actualiza con tus credenciales:

```bash
export TF_VAR_user_ocid="ocid1.user.oc1..*******"
export TF_VAR_tenancy_ocid="ocid1.tenancy.oc1..*******"
export TF_VAR_compartment_ocid="ocid1.compartment.oc1..*******"
export TF_VAR_fingerprint="xx:xx:xx:*******:xx:xx"
export TF_VAR_private_key_path="/Users/TuUsuario/.oci/oci_api_key.pem"
export TF_VAR_region="eu-frankfurt-1"
```

#### 3. Cargar las variables
```bash
source setup_oci_tf_vars.sh
```

</details>

### ğŸ“„ **OpciÃ³n 2: Archivo terraform.tfvars**

<details>
<summary>ğŸ‘† Haz clic para expandir las instrucciones</summary>

#### 1. Copiar el archivo de ejemplo
```bash
cp terraform.tfvars.example terraform.tfvars
```

#### 2. Editar el archivo terraform.tfvars
```hcl
tenancy_ocid            = "ocid1.tenancy.oc1..*******"
user_ocid               = "ocid1.user.oc1..*******"
fingerprint             = "xx:xx:xx:*******:xx:xx"
private_key_path        = "/Users/TuUsuario/.oci/oci_api_key.pem"
region                  = "eu-frankfurt-1"
compartment_ocid        = "ocid1.compartment.oc1..*******"
```

</details>

---

## ğŸ–¥ï¸ Despliegue con Terraform/OpenTofu

### ğŸ“¥ **1. Clonar el Repositorio**

```bash
git clone https://github.com/usuario/arquitecturas-oci-terraform.git
cd arquitecturas-oci-terraform/01_servidor_web_unico
```

### ğŸ”„ **2. Inicializar el Proyecto**

<table>
<tr>
<td><strong>ğŸ”µ Terraform</strong></td>
<td><strong>ğŸŸ¢ OpenTofu</strong></td>
</tr>
<tr>
<td>

```bash
terraform init
```

</td>
<td>

```bash
tofu init
```

</td>
</tr>
</table>

### ğŸ“‹ **3. Planificar el Despliegue**

<table>
<tr>
<td><strong>ğŸ”µ Terraform</strong></td>
<td><strong>ğŸŸ¢ OpenTofu</strong></td>
</tr>
<tr>
<td>

```bash
terraform plan
```

</td>
<td>

```bash
tofu plan
```

</td>
</tr>
</table>

### âœ… **4. Aplicar los Cambios**

<table>
<tr>
<td><strong>ğŸ”µ Terraform</strong></td>
<td><strong>ğŸŸ¢ OpenTofu</strong></td>
</tr>
<tr>
<td>

```bash
terraform apply
```

</td>
<td>

```bash
tofu apply
```

</td>
</tr>
</table>

### ğŸ§¹ **5. Limpiar Recursos**

<table>
<tr>
<td><strong>ğŸ”µ Terraform</strong></td>
<td><strong>ğŸŸ¢ OpenTofu</strong></td>
</tr>
<tr>
<td>

```bash
terraform destroy
```

</td>
<td>

```bash
tofu destroy
```

</td>
</tr>
</table>

---

## â˜ï¸ Despliegue con Oracle Resource Manager

### ğŸš€ Despliegue RÃ¡pido

1. **Haz clic en el botÃ³n de despliegue**:

   [![Deploy to Oracle Cloud](https://oci-resourcemanager-plugin.plugins.oci.oraclecloud.com/latest/deploy-to-oracle-cloud.svg)](https://cloud.oracle.com/resourcemanager/stacks/create?region=home&zipUrl=https://github.com/usuario/arquitecturas-oci-terraform/releases/latest/download/01_servidor_web_unico.zip)

2. **Iniciar sesiÃ³n**: Si no has iniciado sesiÃ³n, introduce las credenciales de tu tenancy y usuario.

3. **Revisar tÃ©rminos**: Acepta los tÃ©rminos y condiciones.

4. **Seleccionar regiÃ³n**: Elige la regiÃ³n donde deseas desplegar el stack.

5. **Crear el stack**: Sigue las instrucciones en pantalla.

6. **Planificar**: Haz clic en **Terraform Actions** â†’ **Plan**.

7. **Revisar**: Espera a que se complete el trabajo y revisa el plan.

8. **Aplicar**: Si todo estÃ¡ correcto, haz clic en **Terraform Actions** â†’ **Apply**.

---

## ğŸ“Š Salidas del Despliegue

DespuÃ©s de un despliegue exitoso, obtendrÃ¡s las siguientes salidas:

| Variable | DescripciÃ³n | Ejemplo |
|----------|-------------|---------|
| `generated_ssh_private_key` | Clave SSH privada generada | `-----BEGIN RSA PRIVATE KEY-----...` |
| `EnterpriseWebserver1PublicIP` | IP pÃºblica del servidor web | `130.61.45.123` |

### ğŸŒ Acceso al Servidor Web

Una vez completado el despliegue:

1. **PÃ¡gina Web**: Visita `http://[IP_PUBLICA]` en tu navegador
2. **SSH**: Conecta usando `ssh -i clave_privada opc@[IP_PUBLICA]`

---

## ğŸ”§ PersonalizaciÃ³n

### ğŸ“ Variables Configurables

| Variable | DescripciÃ³n | Valor por Defecto | Ejemplo |
|----------|-------------|-------------------|---------|
| `VCN-CIDR` | CIDR de la VCN | `10.0.0.0/16` | `192.168.0.0/16` |
| `Subnet-CIDR` | CIDR de la subred | `10.0.1.0/24` | `192.168.1.0/24` |
| `Shape` | Tipo de instancia | `VM.Standard.E4.Flex` | `VM.Standard.E3.Flex` |
| `FlexShapeOCPUS` | NÃºmero de CPUs | `1` | `2` |
| `FlexShapeMemory` | Memoria en GB | `2` | `4` |

### âš™ï¸ Ejemplo de PersonalizaciÃ³n

```hcl
# terraform.tfvars
VCN-CIDR = "192.168.0.0/16"
Subnet-CIDR = "192.168.1.0/24"
Shape = "VM.Standard.E3.Flex"
FlexShapeOCPUS = 2
FlexShapeMemory = 4
```

---

## ğŸ†˜ SoluciÃ³n de Problemas

### âŒ Problemas Comunes

<details>
<summary>ğŸ” <strong>Error de AutenticaciÃ³n</strong></summary>

**Problema**: `Error: 401-NotAuthenticated`

**SoluciÃ³n**:
1. Verifica que las credenciales en `terraform.tfvars` o variables de entorno sean correctas
2. AsegÃºrate de que la clave privada tenga los permisos correctos: `chmod 600 tu_clave_privada.pem`
3. Confirma que el fingerprint coincida con el de tu clave API

</details>

<details>
<summary>ğŸ  <strong>Error de Compartimento</strong></summary>

**Problema**: `Error: 404-NotAuthorizedOrNotFound`

**SoluciÃ³n**:
1. Verifica que el `compartment_ocid` sea correcto
2. AsegÃºrate de tener permisos para crear recursos en ese compartimento
3. Si usas el compartimento raÃ­z, usa el mismo OCID que `tenancy_ocid`

</details>

<details>
<summary>ğŸŒ <strong>Error de RegiÃ³n</strong></summary>

**Problema**: `Error: Service 'Core' is not available in this region`

**SoluciÃ³n**:
1. Verifica que la regiÃ³n especificada sea vÃ¡lida
2. Confirma que tu tenancy tenga acceso a esa regiÃ³n
3. Usa el formato correcto: `eu-frankfurt-1`, `us-ashburn-1`, etc.

</details>

<details>
<summary>ğŸ’¾ <strong>Error de Shape No Disponible</strong></summary>

**Problema**: `Error: The specified shape VM.Standard.E4.Flex is not available`

**SoluciÃ³n**:
1. Verifica la disponibilidad del shape en tu regiÃ³n
2. Prueba con un shape diferente como `VM.Standard.E3.Flex`
3. Revisa los lÃ­mites de servicio de tu tenancy

</details>

### ğŸ” Comandos de DiagnÃ³stico

```bash
# Verificar el plan sin aplicar
terraform plan

# Mostrar el estado actual
terraform show

# Verificar la configuraciÃ³n
terraform validate

# Ver las salidas
terraform output
```

---

## ğŸ“š Recursos Adicionales

### ğŸ“– DocumentaciÃ³n

- [DocumentaciÃ³n de Terraform OCI Provider](https://registry.terraform.io/providers/oracle/oci/latest/docs)
- [GuÃ­a de Oracle Cloud Infrastructure](https://docs.oracle.com/en-us/iaas/Content/home.htm)
- [Mejores PrÃ¡cticas de Terraform](https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html)

### ğŸ“ PrÃ³ximos Pasos

DespuÃ©s de dominar esta arquitectura, continÃºa con:

1. **Arquitectura 2**: Segundo servidor web en otro dominio de disponibilidad
2. **Arquitectura 3**: Balanceador de carga
3. **Arquitectura 4**: NAT Gateway y host bastiÃ³n

---

## ğŸ¤ ContribuciÃ³n

Este proyecto es de cÃ³digo abierto. Â¡EnvÃ­a tus contribuciones haciendo fork del repositorio y enviando un pull request!

### ğŸ“‹ CÃ³mo Contribuir

1. Haz fork del repositorio
2. Crea una rama para tu funcionalidad (`git checkout -b feature/nueva-funcionalidad`)
3. Haz commit de tus cambios (`git commit -am 'Agregar nueva funcionalidad'`)
4. Push a la rama (`git push origin feature/nueva-funcionalidad`)
5. Abre un Pull Request

---

## ğŸ“„ Licencia

Copyright (c) 2025

Licenciado bajo la Licencia Permisiva Universal (UPL), VersiÃ³n 1.0.

Consulta [LICENSE](LICENSE) para mÃ¡s detalles.

---

<div align="center">

**Â¿Te gusta este proyecto? Â¡Dale una â­ en GitHub!**

Hecho con â¤ï¸ para la comunidad de Oracle Cloud Infrastructure

</div>